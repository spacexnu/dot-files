#------------------------------------
# General
#------------------------------------

# Reload config
unbind r
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# Prefix
set -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix

# Mouse
set -g mouse on

# Notifications
set -g monitor-activity on
set -g visual-activity on

# Clipboard integration (tmux 3.2+)
# Keep this ON; actual copy-to-OS happens via bindings below.
set -s set-clipboard on

# Terminal and performance
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB,screen-256color:RGB,alacritty:RGB,tmux-256color:RGB"
set -g focus-events on
set -s escape-time 0
set -g history-limit 100000

# Indexing and window behavior
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Splits (keep current path)
bind -n M-\\ split-window -c "#{pane_current_path}" -h
bind -n M-|  split-window -c "#{pane_current_path}" -v
bind -n M-]  next-layout

# Enable imgcat / passthrough (iTerm2/WezTerm)
set -g allow-passthrough on

#------------------------------------
# Pane navigation and resizing
#------------------------------------

# Navigate between panes vim style (repeatable)
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

# Pane resizing with Alt + h/j/k/l
bind -n M-h resize-pane -L 5
bind -n M-j resize-pane -D 5
bind -n M-k resize-pane -U 5
bind -n M-l resize-pane -R 5

# Quick window navigation
bind -n C-Left  previous-window
bind -n C-Right next-window

# Toggle synchronize-panes
bind S set-window-option synchronize-panes \; display-message "sync: #{?synchronize-panes,on,off}"

#------------------------------------
# Copy-mode (Vi) â€” THE IMPORTANT PART
#------------------------------------

# Vi keys everywhere they matter
setw -g mode-keys vi
set -g status-keys vi

# Enter copy-mode
bind-key [ copy-mode

# Vim-like selection:
#   v = begin selection (visual)
#   V = select entire line (visual-line)
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line

# Search inside copy-mode (/, ?)
bind-key -T copy-mode-vi / command-prompt -i -p "/" "send -X search-forward '%%%'"
bind-key -T copy-mode-vi ? command-prompt -i -p "?" "send -X search-backward '%%%'"

# --- Clipboard: choose ONE block below (Mac OR Linux) ---
# Reason: corporate Linux often lacks xclip/wl-copy. Simpler = reliable.

##### macOS
bind-key -T copy-mode-vi y     send -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "pbcopy"

##### Linux (need to have tools installed)
# X11:
# bind-key -T copy-mode-vi y     send -X copy-pipe-and-cancel "xclip -in -selection clipboard"
# bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "xclip -in -selection clipboard"
#
# Wayland:
# bind-key -T copy-mode-vi y     send -X copy-pipe-and-cancel "wl-copy"
# bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "wl-copy"

#------------------------------------
# Status bar - Minimal dark gray
#------------------------------------

set -g status on
set -g status-interval 5
set -g status-position bottom

# General colors
set -g status-style "bg=#1e1e1e,fg=#b0b0b0"

# Active window
set -g window-status-current-style "bg=#3a3a3a,fg=#e0e0e0"
set -g window-status-current-format " #I:#W "

# Inactive windows
set -g window-status-style "bg=#1e1e1e,fg=#808080"
set -g window-status-format " #I:#W "

# Separators
set -g window-status-separator "  "

# Left side (session)
set -g status-left-length 40
set -g status-left "#[fg=#d0d0d0,bg=#1e1e1e] tmux #[fg=#808080]| #S "

# Right side (host + time)
set -g status-right-length 80
set -g status-right "#[fg=#808080]%Y-%m-%d #[fg=#b0b0b0]%H:%M #[fg=#606060]| #[fg=#909090]#H "

#------------------------------------
# Plugins
#------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'
